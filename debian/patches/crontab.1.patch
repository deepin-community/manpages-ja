From da3909fbbe8f3a4e9e1c598cefb27fb3b207a45f Mon Sep 17 00:00:00 2001
From: Nobuhiro Iwamatsu <iwamatsu@debian.org>
Date: Mon, 8 Jul 2013 07:57:27 +0900
Subject: [PATCH 3/9] Update crontab.1 for debian

Signed-off-by: Nobuhiro Iwamatsu <iwamatsu@debian.org>
---
 manual/cron/man1/crontab.1 |   52 ++++++++++++++++++++++++++++++++++++++------
 1 file changed, 45 insertions(+), 7 deletions(-)

diff --git a/manual/cron/man1/crontab.1 b/manual/cron/man1/crontab.1
index 482ef35..3326f09 100644
--- a/manual/cron/man1/crontab.1
+++ b/manual/cron/man1/crontab.1
@@ -38,21 +38,23 @@ crontab [ -u user ] { -l | -r | -e }
 デーモンの運用に使われるテーブルをインストール・アンインストール・
 表示するためのプログラムである。
 ユーザーはそれぞれ自分用の crontab を保有できる。
-これらは /var 以下に置かれるが、
+これらは /var/spool/cron/crontabs 以下に置かれるが、
 直接には編集できないようにしてある。
 .PP
-.I allow
+.I /etc/cron.allow
 ファイルが存在する場合、ユーザーがこのコマンドを使用するには、
 そのファイル中に（そのユーザーが）リストアップされている必要がある。
-.I allow
+.I /etc/cron.allow
 ファイルは存在せずに
-.I deny
+.I /etc/cron.deny
 ファイルが存在する場合、ユーザーがこのコマンドを使用するには、
-.I deny
+.I /etc/cron.deny
 ファイル中にリストアップされて \fBいない\fR 必要がある。
 いずれのファイルも存在しない場合、スーパーユーザーのみがこのコマンドを
 使えるか、あるいはすべてのユーザーがこのコマンドを使えることになり、
 そのいずれであるかはサイトに依存した設定パラメータによって決まる。
+標準の Debian システムでは、ユーザは誰でも cron
+コマンドを使用できるようになっている。
 .PP
 .I -u
 オプションでは、対象となる crontab の所有者名を指定する。
@@ -77,6 +79,9 @@ crontab [ -u user ] { -l | -r | -e }
 .PP
 .I -l
 オプションは、現在の crontab を標準出力へ表示させる。
+以下の
+.B DEBIAN 固有
+に書かれている注記を参照。
 .PP
 .I -r
 オプションは、現在の crontab を削除する。
@@ -85,12 +90,36 @@ crontab [ -u user ] { -l | -r | -e }
 オプションは、環境変数 \s-1VISUAL\s+1 もしくは \s-1EDITOR\s+1 で指定されている
 エディターを使って、現在の crontab を編集するのに使われる。
 編集終了後、変更された crontab は自動的にインストールされる。
+どちらの環境変数も定義されていない場合は、
+デフォルトのエディタ /usr/bin/editor が使用される。
+.SH DEBIAN 固有
+オリジナルの
+.I crontab -l
+の挙動では、
+crontab ファイルがインストールされたときにファイルの頭に挿入される、
+"DO NOT EDIT THIS FILE" で始まる 3 行のヘッダが表示される。
+問題は、この挙動のために、
+.PP
+crontab -l | crontab -
+.PP
+を繰り返し実行すると同じ結果を返さない、
+つまりヘッダのコピーを追加し続けてしまうことである。
+これは、crontab の編集に sed を使用するスクリプトには悩みの種になる。
+したがって、
+.B -l
+オプションのデフォルトの挙動は、
+そのようなヘッダを出力しないように変更されている。
+環境変数
+.B CRONTAB_NOHEADER
+を 'N' に設定すれば、元々の挙動どおり、
+.I crontab -l
+コマンドが追加のヘッダを出力するようになる。
 .SH 関連項目
 crontab(5), cron(8)
 .SH ファイル
 .nf
-/var/cron/allow
-/var/cron/deny
+/etc/cron/allow
+/etc/cron/deny
 .fi
 .SH 準拠
 .I crontab
@@ -102,6 +131,15 @@ Vixie Cron の前のバージョンと異なっている
 .SH 返り値
 正しくないコマンドラインでこのコマンドを実行すると、
 多少の情報を含む利用法のメッセージが表示される。
+
+.SH バグ
+cron では crontab の各エントリの末尾に改行文字があることが必要になるが、
+crontab コマンドも cron デーモンも、それに関する間違いを検出しない。
+それどころか、crontab は通常どおりロードするように見える。
+しかし、改行文字で終わっていないコマンドは絶対に実行されない。
+間違いを防ぐためには、
+crontab の末尾に必ず空行を入れるようにするのが一番よい。
+
 .SH 著者
 .nf
 Paul Vixie <paul@vix.com>
-- 
1.7.10.4

